<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <link rel="stylesheet" href="/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet"> <style id="jtd-nav-activation"> .site-nav > ul.nav-list:first-child > li > a, .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(1)) > a, .site-nav > ul.nav-list:first-child > li > ul > li > ul > li > a { background-image: none; } .site-nav > ul.nav-list:not(:first-child) a, .site-nav li.external a { background-image: none; } .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(1) > a { font-weight: 600; text-decoration: none; }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg, .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(1) > button svg { transform: rotate(-90deg); }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list, .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list { display: block; } </style> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="icon" href="/assets/images/favicon.ico" type="image/x-icon"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Map Server | OpenVPS</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Map Server" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/pages/tools/map-server.html" /> <meta property="og:url" content="http://localhost:4000/pages/tools/map-server.html" /> <meta property="og:site_name" content="OpenVPS" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Map Server" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Map Server","url":"http://localhost:4000/pages/tools/map-server.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE --> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"> <title id="svg-external-link-title">(external link)</title> <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md --> <symbol id="svg-copy" viewBox="0 0 16 16"> <title>Copy</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/> <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"> <title>Copied</title> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"> <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/> <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> OpenVPS </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </button> </div> <nav aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Home</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Tools category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/pages/tools/tools.html" class="nav-list-link">Tools</a><ul class="nav-list"><li class="nav-list-item"><a href="/pages/tools/map-server.html" class="nav-list-link">Map Server</a></li><li class="nav-list-item"><a href="/pages/tools/geodomain-explorer.html" class="nav-list-link">Geo-domain Explorer</a></li><li class="nav-list-item"><a href="/pages/tools/waypoint-tagger.html" class="nav-list-link">Waypoint Tagger</a></li></ul></li><li class="nav-list-item"><a href="/pages/people.html" class="nav-list-link">People</a></li></ul> </nav> <footer class="site-footer"> Carnegie Mellon University </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search" role="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search OpenVPS" aria-label="Search OpenVPS" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/pages/tools/tools.html">Tools</a></li> <li class="breadcrumb-nav-list-item"><span>Map Server</span></li> </ol> </nav> <div id="main-content" class="main-content"> <main> <h1 class="no_toc" id="map-server"> <a href="#map-server" class="anchor-heading" aria-labelledby="map-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Map server </h1> <p>The <a href="https://github.com/openvps/spatial-server">map server</a> or the spatial server is a reference implementation for a map server that works within the OpenVPS framework. We use <a href="https://github.com/cvg/Hierarchical-Localization">hloc</a> (which in turn uses <a href="https://arxiv.org/abs/1712.07629">SuperPoint</a> and <a href="https://arxiv.org/abs/1911.11763">SuperGlue</a>) for map creation and localization. The map server provides the following functionalites:</p> <ul> <li>Map creation and storage along with tools required to transform maps.</li> <li>Localization against stored maps.</li> <li>Tagging maps with <em>waypoints</em> and exploring tagged points in augmented reality.</li> </ul> <video src="/assets/videos/spatial_server.mp4" autoplay="" loop="" muted="" width="500"></video> <ol id="markdown-toc"> <li><a href="#setting-up-the-map-server" id="markdown-toc-setting-up-the-map-server">Setting up the map server</a></li> <li><a href="#map-creation" id="markdown-toc-map-creation">Map creation</a> <ol> <li><a href="#polycam" id="markdown-toc-polycam">Polycam</a> <ol> <li><a href="#scanning" id="markdown-toc-scanning">Scanning</a></li> <li><a href="#create-map" id="markdown-toc-create-map">Create Map</a></li> <li><a href="#map-creation-logs" id="markdown-toc-map-creation-logs">Map creation logs</a></li> </ol> </li> <li><a href="#video" id="markdown-toc-video">Video</a> <ol> <li><a href="#capture-the-video" id="markdown-toc-capture-the-video">Capture the video</a></li> <li><a href="#create-a-map" id="markdown-toc-create-a-map">Create a map</a></li> <li><a href="#scale-the-map" id="markdown-toc-scale-the-map">Scale the map</a></li> </ol> </li> </ol> </li> <li><a href="#waypoints" id="markdown-toc-waypoints">Waypoints</a> <ol> <li><a href="#upload-waypoints" id="markdown-toc-upload-waypoints">Upload waypoints</a></li> <li><a href="#explore-waypoints" id="markdown-toc-explore-waypoints">Explore waypoints</a></li> </ol> </li> </ol> <h2 id="setting-up-the-map-server"> <a href="#setting-up-the-map-server" class="anchor-heading" aria-labelledby="setting-up-the-map-server"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setting up the map server </h2> <p>Follow instructions on the <a href="https://github.com/openvps/spatial-server">Github repository</a> to set up the map server. Once the map server is set up, the landing page at <a href="https://localhost:8001/">https://localhost:8001/</a> (replace <code class="language-plaintext highlighter-rouge">localhost</code> with your IP address if you have set it up on a remote server) should look like this:</p> <p><img src="/assets/images/map-server/landing-page.png" alt="Map server landing page" width="500" /></p> <h2 id="map-creation"> <a href="#map-creation" class="anchor-heading" aria-labelledby="map-creation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Map creation </h2> <p>Maps can be created using the Polycam application (on iPhones/iPads with a LiDAR (2020+)), or using a 2-D video on android phones.</p> <p class="hint">Polycam is the easiest way to create maps on OpenVPS. Creating a map using a video requires an extra step of estimating real-world scale. Map creation using a video may also fail sometimes because of insuficient overlap between video frames.</p> <h3 id="polycam"> <a href="#polycam" class="anchor-heading" aria-labelledby="polycam"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Polycam </h3> <h4 id="scanning"> <a href="#scanning" class="anchor-heading" aria-labelledby="scanning"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scanning </h4> <ol> <li> <p>We use the same workflow for Polyam as is used in <a href="https://docs.nerf.studio/quickstart/custom_dataset.html#polycam">dataset creation in NeRF Studio</a>. Download the application from the <a href="https://apps.apple.com/us/app/polycam-3d-scanner-lidar-360/id1532482376">app store</a>. Go to the settings and enable developer mode.</p> <p><img src="/assets/images/map-server/polycam-settings.png" alt="Polycam Settings" width="200" /></p> </li> <li>Capture data in LiDAR or Room mode.</li> <li>Tap Process to process the data in the Polycam app.</li> <li>Navigate to the export app pane.</li> <li>Select raw data to export a .zip file.</li> </ol> <h4 id="create-map"> <a href="#create-map" class="anchor-heading" aria-labelledby="create-map"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create Map </h4> <ol> <li>Go to the server landing page and select the “Create Map” option.</li> <li>In the “Map data type” dropdown, select “Polycam”.</li> <li>Enter any Name of your choice.</li> <li>Upload the zip created by the Polycam application in the previous step.</li> <li>Click on “Submit” button. The map creation process will start in the background.</li> </ol> <h4 id="map-creation-logs"> <a href="#map-creation-logs" class="anchor-heading" aria-labelledby="map-creation-logs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Map creation logs </h4> <p>To check the progress of the map creation process, click on the “View Logs” button in the landing page. Select the map name whose creation process was started in the previous step. The map creation logs are displayed live. At the end of the map creation process, the log “Map creation completed” is printed.</p> <p class="highlight">Map creation using Polycam generally takes around 2-3 minutes based on the specific GPU used.</p> <h3 id="video"> <a href="#video" class="anchor-heading" aria-labelledby="video"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Video </h3> <h4 id="capture-the-video"> <a href="#capture-the-video" class="anchor-heading" aria-labelledby="capture-the-video"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Capture the video </h4> <p>Capture a video of the space. Move the camera slowly so that there is sufficient overlap between consecutive video frames. We recommend locking the camera exposure and focus so it is the same across all video frames.</p> <p class="highlight">We find that a resolution of 1920 X 1080 and a frame rate of 30 FPS is suffucient to get good scans.</p> <h4 id="create-a-map"> <a href="#create-a-map" class="anchor-heading" aria-labelledby="create-a-map"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a map </h4> <ol> <li>Go to the server landing page and select the “Create Map” option.</li> <li>In the “Map data type” dropdown, select “Video”.</li> <li>Enter any Name of your choice.</li> <li>Upload the captured video.</li> <li>Mention the percentage of frames to extract from the video for map creation. The default of 25% works well for most videos.</li> <li>Click on “Submit” button. The map creation process will start in the background.</li> </ol> <p>You can view the live logs of the map creation process by going to the “View Logs” page from the landing page.</p> <h4 id="scale-the-map"> <a href="#scale-the-map" class="anchor-heading" aria-labelledby="scale-the-map"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scale the map </h4> <p>A map created from a video capture does not have real-world scale. To scale the world to real-world metrics, we provide an AR application to capture images and their corresponding pose.</p> <p class="important">Currently, the pose and image collection application only works on Android mobile devices such as phones and tablets with a camera.</p> <ol> <li>From the landing page, select the “Save Image Pose” option under “Map Transforms” section.</li> <li>Select the name of the map that was created in the previous step and click on “Collect Data”.</li> <li>Once the a-frame application loads, click on the “AR” option at the bottom right of the screen.</li> <li>Walk to different parts of your space and click on the capture button at the bottom right of the screen. The application sends the AR pose and the captured image to the server. You can see the data collected in the <code class="language-plaintext highlighter-rouge">data/map_data/your_map_name/images_with_pose</code> directory.</li> <li>Go back to the server landing page and select the “Scale Map” option under “Map Transforms”. The server uses the collected images and pose to automatically scale the map.</li> </ol> <h2 id="waypoints"> <a href="#waypoints" class="anchor-heading" aria-labelledby="waypoints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Waypoints </h2> <h3 id="upload-waypoints"> <a href="#upload-waypoints" class="anchor-heading" aria-labelledby="upload-waypoints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upload waypoints </h3> <p>Download the map using the “Download Map” button on the landing page. A zip file containing the map point cloud is downloaded. Extract the zip file. Upload the point cloud to the <a href="/pages/tools/waypoint-tagger.html">Waypoint Tagger tool</a>. This helps you visualize the generated point cloud. Tag waypoints using <a href="/pages/tools/waypoint-tagger.html">instructions from the tool page</a>. The tagged waypoints can be downloaded as a CSV from the tagger tool.</p> <p class="highlight">If the point cloud looks upside down (the ceiling is at the bottom and the floor is at the top), go to the “Rotate Map” option in the landing page to rotate the map by 180 degrees along the X-axis.</p> <p>Click on the “Upload Waypoints” button on the map server landing page. Select the map name and upload the waypoints CSV file.</p> <h3 id="explore-waypoints"> <a href="#explore-waypoints" class="anchor-heading" aria-labelledby="explore-waypoints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Explore waypoints </h3> <p>We provide an augmented reality application to explore the tagged waypoints graph overlaid against the real-world.</p> <video src="/assets/videos/explore_waypoints.mp4" autoplay="" loop="" muted="" width="500"></video> <p class="important">The AR application only works on Android device such as phones and tablets with a camera.</p> <p>Click on the “Explore Waypoints” button on the server landing page. Once the web application opens, click on he AR button at the bottom right corner of the page. The application should localize against the map created in the previous steps and should show the waypoints overlaid against the real-wold.</p> </main> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
